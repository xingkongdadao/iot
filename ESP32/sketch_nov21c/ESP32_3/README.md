# ESP32_3 - 本地存储容量测试程序

## 功能说明

这是一个专门用于测试 ESP32 本地存储容量的程序，主要功能包括：

- **高速数据生成**：每秒生成 100 条数据（每 10ms 生成 1 条）
- **数据类型**：与 ESP32_2 相同的数据结构
  - 模拟长度（float）：40.0~80.0 cm
  - 日期时间（time_t）：时间戳
- **本地存储**：所有数据均保存到 LittleFS 文件系统
- **统计监控**：每生成 100 条数据后输出详细统计信息
- **内存保护**：当可用内存低于阈值时，自动删除最旧的数据（FIFO）

## 统计信息

程序会在每生成 100 条数据后输出以下统计信息：

### 数据统计
- **总生成数据量**：从程序启动开始累计生成的数据条数
- **当前存储数据量**：LittleFS 中实际存储的数据条数
- **已删除数据量**：因内存保护而删除的数据条数
- **首次删除发生时间**：记录在第几条数据时首次触发删除机制
- **删除批次次数**：记录删除操作发生的次数

### 内存信息
- **总堆内存**：ESP32 的总堆内存大小
- **已用堆内存**：当前已使用的堆内存
- **可用堆内存**：当前可用的堆内存
- **内存使用率**：已用内存占总内存的百分比

### 存储信息
- **LittleFS 总容量**：文件系统的总容量
- **LittleFS 已使用**：当前已使用的存储空间
- **LittleFS 可用**：当前可用的存储空间
- **LittleFS 使用率**：已用存储占总容量的百分比
- **平均每条数据**：每条数据平均占用的存储空间（字节）
- **估算最大存储量**：基于当前平均大小估算的最大可存储数据量

## 配置参数

### 数据生成配置
```cpp
const unsigned long generateInterval = 10;  // 每10ms生成1条数据（每秒100条）
```

### 存储配置
```cpp
const char* dataFilePath = "/sensor_data.json";  // 数据文件路径
const size_t minFreeHeap = 20000;                // 最小可用堆内存阈值（字节）
const size_t JSON_DOC_SIZE = 1048576;            // JSON 文档大小（1MB）
```

## 使用方法

1. **上传程序**：将 `ESP32_3.ino` 上传到 ESP32 开发板
2. **打开串口监视器**：设置波特率为 115200
3. **观察输出**：程序会自动开始生成数据并输出统计信息
4. **记录关键数据**：
   - 首次删除发生时的数据量
   - 最大存储数据量
   - 内存和存储的使用情况

## 测试目标

通过运行此程序，可以了解：

1. **最大存储容量**：ESP32 的 LittleFS 可以存储多少条数据
2. **内存限制**：在多少条数据后开始触发内存保护机制
3. **存储效率**：每条数据平均占用多少存储空间
4. **系统稳定性**：在持续高速写入下的系统表现

## 注意事项

- 程序会持续运行，直到手动停止或设备重启
- 建议在测试前清空 LittleFS，以获得准确的测试结果
- 如需清空存储，可以在 Arduino IDE 中格式化文件系统
- 程序不包含 WiFi 连接和网络上传功能，专注于本地存储测试

## 输出示例

```
========================================
[统计] 每100条数据统计信息
========================================
总生成数据量: 100 条
当前存储数据量: 100 条
已删除数据量: 0 条
首次删除: 尚未发生

[内存信息]
  总堆内存: 295.00 KB
  已用堆内存: 45.23 KB
  可用堆内存: 249.77 KB
  内存使用率: 15.33 %

[存储信息]
  LittleFS 总容量: 1400.00 KB
  LittleFS 已使用: 2.45 KB
  LittleFS 可用: 1397.55 KB
  LittleFS 使用率: 0.18 %
  平均每条数据: 25.09 字节
  估算最大存储量: 55800 条
========================================
```

## 与 ESP32_2 的区别

| 特性 | ESP32_2 | ESP32_3 |
|------|---------|---------|
| 数据生成频率 | 每5秒1条 | 每秒100条 |
| WiFi 连接 | ✓ | ✗ |
| 数据上传 | ✓ | ✗ |
| 存储测试 | ✗ | ✓ |
| 统计监控 | 基础 | 详细 |
| 用途 | 生产环境 | 测试环境 |

